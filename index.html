
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin - ADD</title>
<link://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css
<script src="https://cdn.sheetjs.com/xlsx-latest/packagell.min.js</script>
<style>
    body { background: #f8f9fa; padding: 20px; }
    .container { max-width: 1200px; margin: auto; }
</style>
</head>
<body>
<div class="container">
    <h2 class="mb-4">üìä Painel do Administrador</h2>
    <p id="status" class="text-danger"></p>
    <button class="btn btn-success mb-3" onclick="baixarXLSX()">‚¨áÔ∏è Baixar XLSX</button>
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>ID</th><th>Nome</th><th>Email</th><th>Regional</th><th>Polo</th>
                <th>Matr√≠cula</th><th>Data Uso</th><th>Tipo Refei√ß√£o</th><th>Hor√°rio</th>
                <th>Localidade</th><th>GPS</th><th>Sequ√™ncia</th><th>OS/RRSS</th><th>N¬∫ ADD</th><th>Observa√ß√£o</th>
            </tr>
        </thead>
        <tbody id="tabela"></tbody>
    </table>
</div>

<script>
let dados = [];

document.addEventListener("DOMContentLoaded", async () => {
    const matricula = localStorage.getItem("matricula");
    const status = document.getElementById("status");

    if (matricula !== "3080117") {
        status.innerText = "‚ùå Acesso negado. Apenas administradores podem ver esta p√°gina.";
        setTimeout(() => window.location.href = "https://pedrofillype14.github.io/login/", 3000);
        return;
    }

    try {
        const resp = await fetch("https://long-hall-0aaa.pedro-fillype.workers.dev/buscar-todos");
        dados = await resp.json();

        if (!Array.isArray(dados) || dados.length === 0) {
            status.innerText = "Nenhum registro encontrado.";
            return;
        }

        preencherTabela(dados);
    } catch (err) {
        status.innerText = "Erro ao carregar dados: " + err.message;
    }
});

function preencherTabela(lista) {
    const tabela = document.getElementById("tabela");
    tabela.innerHTML = "";
    lista.forEach(item => {
        tabela.innerHTML += `
            <tr>
                <td>${item.id}</td><td>${item.nome}</td><td>${item.email}</td><td>${item.regional}</td>
                <td>${item.polo}</td><td>${item.matricula}</td><td>${item.datauso}</td><td>${item.tiporefeicao}</td>
                <td>${item.horario}</td><td>${item.localidade}</td><td>${item.gps}</td><td>${item.sequencia || ""}</td>
                <td>${item.osrrss || ""}</td><td>${item.numeroadd || ""}</td><td>${item.observacao || ""}</td>
            </tr>
        `;
    });
}

function baixarXLSX() {
    if (!dados.length) {
        alert("Nenhum dado para exportar.");
        return;
    }
    const ws = XLSX.utils.json_to_sheet(dados);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Registros");
    XLSX.writeFile(wb, "registros_ADD.xlsx");
}
</script>
</body>
</html>
